<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/dashboard.css" rel="stylesheet">
    <link href="/css/header.css" rel="stylesheet">
    <link href="/css/new_ticket.css" rel="stylesheet">

    <script type="text/javascript" src="/js/ScheduleAction.js"></script>
    <script type="text/javascript" src="/js/ServiceTicket.js"></script>
    <script type="text/javascript" src="/js/RegisterDevice.js"></script>
    <script type="text/javascript" src="/js/RegisterCustomer.js"></script>

    <title>Employee Dashboard - Midnight Technician</title>
</head>
<body>
<div th:replace="~{fragments/header::header}"></div>

<!-- Header -->
<div class="dashboard-header">
    <div class="container">
        <div class="welcome-section">
            <h1 class="welcome-title">
                Welcome, <span th:text="${employee.firstName()}" class="customer-name">Technician</span>!
            </h1>
            <p class="welcome-subtitle">Manage and process service tickets efficiently</p>
        </div>
    </div>
</div>

<!-- Main Dashboard -->
<div class="container dashboard-container">
    <input type="hidden" id="employeeId" th:value="${employee.employeeId}">

    <!-- Quick Overview -->
    <section class="quick-actions-section">
        <div class="actions-grid">
            <button class="action-card punch-card" onclick="punchIn()">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="16" cy="16" r="10"></circle>
                        <polyline points="16 8 16 16 20 18"></polyline>
                        <path d="M4 16H1m5-9L4 5"></path>
                    </svg>
                </div>
                <h3>Clock-In</h3>
                <p>Clock-In for the day</p>
            </button>

            <button class="action-card punch-card" onclick="punchOut()">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="16" cy="16" r="10"></circle>
                        <polyline points="16 8 16 16 20 18"></polyline>
                        <path d="M28 16h3m-5-9l2-2"></path>
                    </svg>
                </div>
                <h3>Clock-Out</h3>
                <p>Clock-Out for the day</p>
            </button>

            <button class="action-card" onclick="openNewCustomerModal()">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="16" cy="9" r="5"></circle>
                        <path d="M6 30v-5c0-3.3 2.7-6 6-6h8c3.3 0 6 2.7 6 6v5"></path>
                        <line x1="16" y1="25" x2="16" y2="31"></line>
                        <line x1="13" y1="28" x2="19" y2="28"></line>
                    </svg>
                </div>
                <h3>Add Customer</h3>
                <p th:text="${customerCount} + ' customers'">120 registered</p>
            </button>

            <button class="action-card" onclick="openNewDeviceModal()">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                        <line x1="8" y1="21" x2="16" y2="21"></line>
                        <line x1="12" y1="17" x2="12" y2="21"></line>
                        <line x1="12" y1="7" x2="12" y2="13"></line>
                        <line x1="9" y1="10" x2="15" y2="10"></line>
                    </svg>
                </div>
                <h3>Add Device</h3>
                <p th:text="${customerDeviceCount} + ' devices'">42 open</p>
            </button>

            <button class="action-card" onclick="openNewTicketModal()">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="12" y1="18" x2="12" y2="12"></line>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                </div>
                <h3>Create Ticket</h3>
                <p th:text="${activeTicketCount} + ' tickets'">80 closed</p>
            </button>

        </div>
    </section>


    <section class="tickets-section">
        <div class="section-header">
            <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" stroke="currentColor"
                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 3h18v4H3zM3 11h18v4H3zM3 19h18v2H3z"></path>
                </svg>
                Your active Requests
            </h2>
            <div>
                <span class="ticket-count" th:text="${#lists.size(employeeActiveTickets)} + ' total'">17 total</span>
            </div>
        </div>


        <div th:unless="${!#lists.isEmpty(employeeActiveTickets)}">
            <p>No open tickets found.</p>
        </div>
        <div class="tickets-grid">
            <div th:if="${!#lists.isEmpty(employeeActiveTickets)}" th:each="ticket : ${employeeActiveTickets}">
                <div th:if="${#strings.equalsIgnoreCase(ticket.status, 'pending')}">
                    <div class="ticket-card status-pending">
                        <div class="ticket-header">
                            <span class="ticket-id" th:text="${ticket.ticketId}">#TCK-001</span>
                            <span class="ticket-status" th:text="${ticket.status}">Pending</span>
                        </div>
                        <h3 class="ticket-title" th:text="${ticket.title}">Repair</h3>
                        <p class="ticket-description" th:text="${ticket.description}">MacBook Pro screen cracked, needs
                            replacement</p>
                        <div class="ticket-footer">
                        <span class="ticket-date" th:text="${ticket.createdAt}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            2 days ago
                        </span>
                            <a class="ticket-view-btn btn btn-primary"
                               th:href="@{/dashboard/user/ticket(id=${ticket.ticketId})}">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>

                <div th:if="${#strings.equalsIgnoreCase(ticket.status, 'In_Progress')}">
                    <div class="ticket-card status-progress">
                        <div class="ticket-header">
                            <span class="ticket-id" th:text="${ticket.ticketId}">#TCK-001</span>
                            <span class="ticket-status" th:text="${ticket.status}">Pending</span>
                        </div>
                        <h3 class="ticket-title" th:text="${ticket.title}">Repair</h3>
                        <p class="ticket-description" th:text="${ticket.description}">MacBook Pro screen cracked, needs
                            replacement</p>
                        <div class="ticket-footer">
                        <span class="ticket-date" th:text="${ticket.createdAt}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            2 days ago
                        </span>
                            <a class="ticket-view-btn btn btn-primary"
                               th:href="@{/dashboard/user/ticket(id=${ticket.ticketId})}">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>

                <div th:if="${#strings.equalsIgnoreCase(ticket.status, 'open')}">
                    <div class="ticket-card status-review">
                        <div class="ticket-header">
                            <span class="ticket-id" th:text="${ticket.ticketId}">#TCK-001</span>
                            <span class="ticket-status" th:text="${ticket.status}">Pending</span>
                        </div>
                        <h3 class="ticket-title" th:text="${ticket.title}">Repair</h3>
                        <p class="ticket-description" th:text="${ticket.description}">MacBook Pro screen cracked, needs
                            replacement</p>
                        <div class="ticket-footer">
                        <span class="ticket-date" th:text="${ticket.createdAt}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            2 days ago
                        </span>
                            <a class="ticket-view-btn btn btn-primary"
                               th:href="@{/dashboard/user/ticket(id=${ticket.ticketId})}">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Ticket Management -->
    <section class="tickets-section">
        <div class="section-header">
            <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" stroke="currentColor"
                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 3h18v4H3zM3 11h18v4H3zM3 19h18v2H3z"></path>
                </svg>
                Unclaimed Service Requests
            </h2>
            <div>
                <span class="ticket-count" th:text="${#lists.size(openTickets)} + ' total'">17 total</span>
            </div>
        </div>

        <div class="tickets-grid">
            <!-- Unclaimed Tickets -->
            <div th:each="ticket : ${openTickets}" class="ticket-card status-pending">
                <div class="ticket-header">
                    <span class="ticket-id" th:text="'#' + ${ticket.ticketId}">#1245</span>
                    <span class="ticket-status">Unclaimed</span>
                </div>
                <h3 class="ticket-title" th:text="${ticket.title}">Printer not working</h3>
                <p class="ticket-description" th:text="${ticket.description}">Customer reports printer failure...</p>

                <div class="ticket-footer">
                    <span class="ticket-date">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor"
                             stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 4h18M5 2v4M19 2v4M4 10h16v10H4z"></path>
                        </svg>
                        <span th:text="${ticket.createdAt}">2025-10-25</span>
                    </span>
                    <a class="ticket-view-btn btn btn-primary" th:href="@{/dashboard/ticket(id=${ticket.ticketId})}">
                        View Details
                    </a>
                </div>
            </div>
        </div>
    </section>

    <section class="tickets-section">
        <div class="section-header">
            <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" stroke="currentColor"
                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 3h18v4H3zM3 11h18v4H3zM3 19h18v2H3z"></path>
                </svg>
                Active Tickets with last 7-Days
            </h2>
            <div>
                <span class="ticket-count" th:text="${#lists.size(claimedTickets)} + ' total'">17 total</span>
            </div>
        </div>
        <div class="tickets-grid">
            <!-- Claimed Tickets -->
            <div th:each="ticket : ${claimedTickets}" class="ticket-card status-progress">
                <div class="ticket-header">
                    <span class="ticket-id" th:text="'#' + ${ticket.ticketId}">#1250</span>
                    <span class="ticket-status">Claimed</span>
                </div>
                <h3 class="ticket-title" th:text="${ticket.title}">Network issue</h3>
                <p class="ticket-description" th:text="${ticket.description}">Investigating network dropouts...</p>

                <div class="ticket-footer">
                    <span class="ticket-date">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor"
                             stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 4h18M5 2v4M19 2v4M4 10h16v10H4z"></path>
                        </svg>
                        <span th:text="${ticket.updatedAt}">2025-10-25</span>
                    </span>
                    <a class="ticket-view-btn btn btn-primary" th:href="@{/dashboard/ticket(id=${ticket.ticketId})}">
                        View Details
                    </a>
                </div>
            </div>
        </div>
    </section>

    <footer class="dashboard-footer">
        <p class="tagline"><em>Midnight Technician â€“ Supporting Excellence.</em></p>
    </footer>
</div>
<div th:replace="~{fragments/view/employee/customer_search::customer_search}"></div>
<div th:replace="~{fragments/view/employee/customer_creation::new_customer}"></div>
<div th:replace="~{fragments/view/customer_dashboard/customer_ticket_creation::#newTicketModal}"></div>
<div th:replace="~{fragments/view/customer_dashboard/customer_device_registration::#newDeviceModal}"></div>
</body>
</html>
